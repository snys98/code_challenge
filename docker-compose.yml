version: '3.7'

name: dev_challenge_io

services:
  api:
    image: ghcr.io/snys98/challenge/api:latest
    ports:
      - 3000:3000
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.api.rule=Host(`api.${DOMAIN_NAME}`)"
      - "traefik.http.routers.api.entrypoints=http,https"
      - "traefik.http.routers.api.tls=true"
    dns: 172.22.0.2
    healthcheck:
      test: ["CMD-SHELL", "curl", "-f", "http://localhost:3000"]  
      interval: 10s  
      timeout: 5s  
      retries: 3  
    networks: 
      - dev
  app:
    image: ghcr.io/snys98/challenge/app:latest
    ports:
      - 4000:4000
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.app.rule=Host(`app.${DOMAIN_NAME}`)"
      - "traefik.http.routers.app.entrypoints=http,https"
      - "traefik.http.routers.app.tls=true"
    dns: 172.22.0.2
    healthcheck:
      test: ["CMD-SHELL", "curl", "-f", "http://localhost:4000"]  
      interval: 10s  
      timeout: 5s  
      retries: 3  
    networks:
      - dev
  scheduler:
    image: ghcr.io/snys98/challenge/scheduler:latest
    dns: 172.22.0.2
    networks:
      - dev

networks: 
    dev:
      external: true  
